<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coinflip - PVP Solana Wagers</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <h1>‚öîÔ∏è Coinflip</h1>
                <p class="tagline">PVP Solana Wagers ‚Ä¢ Provably Fair ‚Ä¢ 2% Fee</p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Active Wagers Section -->
            <section class="wagers-section">
                <h2>üî• Active Wagers</h2>
                <p class="section-subtitle">Accept a wager or create your own</p>

                <div id="activeWagers" class="wagers-list">
                    <div class="loading-wagers">Loading wagers...</div>
                </div>

                <button id="createWagerBtn" class="btn btn-primary btn-large">
                    ‚öîÔ∏è Create New Wager
                </button>
            </section>

            <!-- Create Wager Modal -->
            <div id="createWagerModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <span class="modal-close" onclick="closeCreateModal()">&times;</span>

                    <!-- Step 1: Choose Side & Amount -->
                    <div id="step1" class="create-step">
                        <h2>Create PVP Wager</h2>

                        <div class="step-section">
                            <h3>1. Choose Your Side</h3>
                            <div class="side-selection">
                                <button class="side-btn" data-side="heads" onclick="selectSide('heads')">
                                    <span class="side-emoji">ü™ô</span>
                                    <span>HEADS</span>
                                </button>
                                <button class="side-btn" data-side="tails" onclick="selectSide('tails')">
                                    <span class="side-emoji">üéØ</span>
                                    <span>TAILS</span>
                                </button>
                            </div>
                        </div>

                        <div class="step-section">
                            <h3>2. Wager Amount (SOL)</h3>
                            <div class="amount-buttons">
                                <button class="amount-btn" onclick="selectAmount(0.1)">0.1</button>
                                <button class="amount-btn" onclick="selectAmount(0.5)">0.5</button>
                                <button class="amount-btn" onclick="selectAmount(1)">1</button>
                                <button class="amount-btn" onclick="selectAmount(5)">5</button>
                            </div>
                            <div class="custom-amount">
                                <input type="number" id="customAmount" placeholder="Custom amount" step="0.01" min="0.01">
                                <button class="btn btn-secondary" onclick="useCustomAmount()">Use</button>
                            </div>
                        </div>

                        <div class="step-section">
                            <h3>3. Your Solana Address (to receive winnings)</h3>
                            <input type="text" id="creatorWallet" class="wallet-input" placeholder="Your Solana wallet address">
                        </div>

                        <div id="wagerSummary" class="wager-summary" style="display: none;">
                            <h3>Summary</h3>
                            <div class="summary-row">
                                <span>Side:</span>
                                <span id="summarySide">-</span>
                            </div>
                            <div class="summary-row">
                                <span>Wager:</span>
                                <span id="summaryAmount">-</span>
                            </div>
                            <div class="summary-row highlight">
                                <span>Total to Deposit:</span>
                                <span id="summaryTotal">-</span>
                            </div>
                            <p class="fee-note">Includes 0.025 SOL network fee</p>
                        </div>

                        <button id="continueBtn" class="btn btn-primary btn-large" onclick="continueToDeposit()" disabled>
                            Continue ‚Üí
                        </button>
                    </div>

                    <!-- Step 2: Deposit Instructions -->
                    <div id="step2" class="create-step" style="display: none;">
                        <h2>üì• Deposit to Escrow</h2>

                        <div class="escrow-info">
                            <p>Send exactly <strong id="depositAmount">-</strong> SOL to this escrow wallet:</p>

                            <div class="escrow-address-box">
                                <code id="escrowAddress">-</code>
                                <button class="copy-btn" onclick="copyEscrowAddress()">üìã Copy</button>
                            </div>

                            <div class="qr-placeholder">
                                <p>Scan with any Solana wallet</p>
                            </div>
                        </div>

                        <div class="deposit-steps">
                            <p>‚úÖ Open your Solana wallet (Phantom, Solflare, etc.)</p>
                            <p>‚úÖ Send exactly <strong id="depositAmount2">-</strong> SOL</p>
                            <p>‚úÖ Paste transaction signature below</p>
                        </div>

                        <div class="tx-input-section">
                            <label>Transaction Signature:</label>
                            <input type="text" id="depositTxSignature" class="tx-input" placeholder="Paste your transaction signature here">
                        </div>

                        <button id="verifyDepositBtn" class="btn btn-primary btn-large" onclick="verifyDeposit()">
                            ‚úì Verify Deposit & Create Wager
                        </button>

                        <button class="btn btn-secondary" onclick="backToStep1()">‚Üê Back</button>
                    </div>

                    <!-- Step 3: Success -->
                    <div id="step3" class="create-step" style="display: none;">
                        <div class="success-content">
                            <div class="success-icon">‚úÖ</div>
                            <h2>Wager Created!</h2>
                            <p>Your wager is now live and waiting for an opponent.</p>

                            <div class="wager-details">
                                <div class="detail-row">
                                    <span>Wager ID:</span>
                                    <span id="newWagerId">-</span>
                                </div>
                                <div class="detail-row">
                                    <span>Amount:</span>
                                    <span id="newWagerAmount">-</span>
                                </div>
                                <div class="detail-row">
                                    <span>Your Side:</span>
                                    <span id="newWagerSide">-</span>
                                </div>
                            </div>

                            <p class="waiting-text">‚è≥ Waiting for opponent to accept...</p>

                            <button class="btn btn-primary" onclick="closeCreateModal()">Done</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Accept Wager Modal -->
            <div id="acceptWagerModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <span class="modal-close" onclick="closeAcceptModal()">&times;</span>

                    <!-- Step 1: Confirm & Enter Wallet -->
                    <div id="acceptStep1" class="create-step">
                        <h2>‚öîÔ∏è Accept Wager</h2>

                        <div class="wager-to-accept">
                            <div class="accept-row">
                                <span>Wager Amount:</span>
                                <span id="acceptAmount" class="highlight">-</span>
                            </div>
                            <div class="accept-row">
                                <span>Creator's Side:</span>
                                <span id="acceptCreatorSide">-</span>
                            </div>
                            <div class="accept-row">
                                <span>Your Side:</span>
                                <span id="acceptYourSide" class="highlight">-</span>
                            </div>
                            <div class="accept-row total">
                                <span>Total to Deposit:</span>
                                <span id="acceptTotal">-</span>
                            </div>
                        </div>

                        <div class="step-section">
                            <h3>Your Solana Address (to receive winnings)</h3>
                            <input type="text" id="acceptorWallet" class="wallet-input" placeholder="Your Solana wallet address">
                        </div>

                        <button id="acceptContinueBtn" class="btn btn-primary btn-large" onclick="continueToAcceptDeposit()">
                            Continue to Deposit ‚Üí
                        </button>

                        <button class="btn btn-secondary" onclick="closeAcceptModal()">Cancel</button>
                    </div>

                    <!-- Step 2: Deposit -->
                    <div id="acceptStep2" class="create-step" style="display: none;">
                        <h2>üì• Deposit to Accept</h2>

                        <div class="escrow-info">
                            <p>Send exactly <strong id="acceptDepositAmount">-</strong> SOL to this escrow wallet:</p>

                            <div class="escrow-address-box">
                                <code id="acceptEscrowAddress">-</code>
                                <button class="copy-btn" onclick="copyAcceptEscrowAddress()">üìã Copy</button>
                            </div>
                        </div>

                        <div class="tx-input-section">
                            <label>Transaction Signature:</label>
                            <input type="text" id="acceptTxSignature" class="tx-input" placeholder="Paste your transaction signature here">
                        </div>

                        <button id="verifyAcceptBtn" class="btn btn-primary btn-large" onclick="verifyAcceptDeposit()">
                            ‚úì Verify & Execute Coinflip!
                        </button>

                        <button class="btn btn-secondary" onclick="backToAcceptStep1()">‚Üê Back</button>
                    </div>

                    <!-- Step 3: Result -->
                    <div id="acceptStep3" class="create-step" style="display: none;">
                        <div id="gameResultContent">
                            <!-- Filled by JavaScript -->
                        </div>
                        <button class="btn btn-primary" onclick="closeAcceptModal()">Done</button>
                    </div>
                </div>
            </div>

            <!-- How It Works -->
            <section class="how-it-works">
                <h2>How It Works</h2>
                <div class="steps-grid">
                    <div class="step-card">
                        <div class="step-number">1</div>
                        <h3>Create or Accept</h3>
                        <p>Create a wager with your chosen side and amount, or accept an existing wager</p>
                    </div>
                    <div class="step-card">
                        <div class="step-number">2</div>
                        <h3>Deposit to Escrow</h3>
                        <p>Send your wager + 0.025 SOL fee to a unique escrow wallet</p>
                    </div>
                    <div class="step-card">
                        <div class="step-number">3</div>
                        <h3>Coinflip!</h3>
                        <p>When both deposits are verified, the coin flips using Solana blockhash</p>
                    </div>
                    <div class="step-card">
                        <div class="step-number">4</div>
                        <h3>Winner Gets Paid</h3>
                        <p>Winner receives 98% of both wagers instantly (2% platform fee)</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>üîí Provably Fair ‚Ä¢ All results verifiable on Solana blockchain</p>
            <p class="footer-links">
                <a href="https://t.me/coinflipvpbot" target="_blank">Telegram Bot</a> ‚Ä¢
                <a href="#" onclick="showFairnessInfo()">Fairness</a>
            </p>
        </footer>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
